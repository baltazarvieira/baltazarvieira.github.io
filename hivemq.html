<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Controle de Lâmpadas - MQTT</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f2f2f2;
    padding-top: 30px;
}
button {
    width: 150px;
    height: 50px;
    font-size: 20px;
    margin: 10px;
}
.status {
    font-size: 24px;
    margin-top: 20px;
}
</style>
</head>

<body>

<h2>Controle de Lâmpadas via HiveMQ Cloud</h2>

<h3>Lâmpada 1</h3>
<button onclick="sendMessage('casa/lampada1', 'ON')">Ligar</button>
<button onclick="sendMessage('casa/lampada1', 'OFF')">Desligar</button>

<h3>Lâmpada 2</h3>
<button onclick="sendMessage('casa/lampada2', 'ON')">Ligar</button>
<button onclick="sendMessage('casa/lampada2', 'OFF')">Desligar</button>

<div class="status" id="statusMsg">Conectando ao MQTT...</div>

<script>

// ===== CONFIGURAÇÕES MQTT =====
const options = {
    username: "baltazarvieira",
    password: "ZAQmko1968",
    clean: true,
    connectTimeout: 4000,
    reconnectPeriod: 2000
};

// Conexão WebSocket segura (WSS)
const client = mqtt.connect(
    "wss://5123f02098764d0885f1db6e2d8fcab5.s1.eu.hivemq.cloud:8884/mqtt",
    options
);

// Tópicos usados no NodeMCU
const topico1 = "casa/lampada1";
const topico2 = "casa/lampada2";

client.on("connect", () => {
    document.getElementById("statusMsg").innerText = "Conectado ao MQTT!";

    client.subscribe(topico1);
    client.subscribe(topico2);
});

client.on("message", (topic, message) => {
    console.log("Recebido:", topic, message.toString());
});

client.on("error", (err) => {
    document.getElementById("statusMsg").innerText = "Erro MQTT!";
    console.error(err);
});

// Função para enviar mensagens
function sendMessage(topic, msg) {
    client.publish(topic, msg);
}

</script>

</body>
</html>
